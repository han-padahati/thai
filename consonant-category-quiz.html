<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ³°æ–‡å­éŸ³åˆ†é¡æ¸¬é©—</title>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans TC', 'sans-serif'],
                        thai: ['Noto Sans Thai', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#0d9488', // Indigo-600
                        'secondary': '#6b7280', // Orange-600
                    }
                }
            }
        }
    </script>
    <style>
        /* ç¢ºä¿æ³°æ–‡å­—é«”èƒ½æ­£ç¢ºé¡¯ç¤º */
        .font-thai {
            font-family: 'Noto Sans Thai', 'sans-serif';
            line-height: 1;
        }
        .quiz-container {
            max-width: 768px;
        }
        .option-button {
            transition: all 0.2s;
            height: 5rem; /* ç¢ºä¿æŒ‰éˆ•é«˜åº¦ä¸€è‡´ */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .correct-answer {
            background-color: #10b981; /* Emerald-500 */
            color: white;
            border-color: #10b981;
        }
        .incorrect-answer {
            background-color: #ef4444; /* Red-500 */
            color: white;
            border-color: #ef4444;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4 font-sans">

    <div id="quiz-container" class="quiz-container w-full bg-white shadow-xl rounded-2xl p-6 md:p-10">
        <h1 class="text-3xl font-extrabold text-gray-900 mb-6 text-center">
            æ³°æ–‡å­éŸ³åˆ†é¡æ¸¬é©—
        </h1>

        <!-- æ¸¬é©—å…§å®¹å€ -->
        <div id="quiz-content" class="space-y-6">
            <!-- é¡Œç›®å€ -->
            <div id="question-card" class="bg-primary bg-opacity-10 p-4 md:p-6 rounded-xl shadow-lg">
                <p id="question-text" class="text-xl font-semibold text-gray-800 text-center">
                    è¼‰å…¥ä¸­...
                </p>
                <!-- ç§»é™¤äº†åŸæœ‰çš„ consonants-displayï¼Œå­éŸ³å°‡ç›´æ¥åœ¨æŒ‰éˆ•ä¸Šé¡¯ç¤º -->
            </div>

            <!-- é¸é …æŒ‰éˆ•å€ -->
            <div id="options-container" class="grid grid-cols-2 gap-4">
                <!-- é¸é …æŒ‰éˆ•å°‡åœ¨æ­¤è™•ç”Ÿæˆ -->
            </div>

            <!-- çµæœèˆ‡æŒ‰éˆ•å€ -->
            <div id="result-area" class="mt-8 pt-4 border-t border-gray-200 space-y-4">
                <div id="message-box" class="min-h-10 text-center text-lg font-bold">
                    <!-- æç¤ºæˆ–çµæœè¨Šæ¯ -->
                    <!-- ç§»é™¤äº†åˆå§‹çš„ "è«‹é¸æ“‡åˆ†é¡ä¸åŒçš„å­éŸ³ï¼š" æç¤º -->
                </div>
                
                <div id="explanation-box" class="hidden bg-yellow-50 border-l-4 border-secondary p-3 rounded">
                    <p class="font-semibold text-secondary mb-1">ğŸ’¡ è©³è§£ï¼š</p>
                    <!-- æ”¾å¤§è©³è§£æ–‡å­— -->
                    <p id="explanation-text" class="text-gray-700 text-base"></p>
                </div>

                <button id="next-button" onclick="loadNextQuestion()" class="w-full py-3 bg-secondary text-white font-bold rounded-lg shadow-md hover:bg-orange-700 transition duration-150 ease-in-out">
                    ä¸‹ä¸€é¡Œ
                </button>
            </div>
        </div>
    </div>

    <script>
        // æ³°æ–‡å­éŸ³åŠå…¶é¡åˆ¥ (è¤‡è£½è‡ª Python ç¨‹å¼)
        const CONSONANTS = {
            "ä¸­å­éŸ³ (Middle)": ['à¸', 'à¸ˆ', 'à¸', 'à¸', 'à¸”', 'à¸•', 'à¸š', 'à¸›', 'à¸­'],
            "é«˜å­éŸ³ (High)": ['à¸‚', 'à¸‰', 'à¸', 'à¸–', 'à¸œ', 'à¸', 'à¸¨', 'à¸©', 'à¸ª', 'à¸«'],
            "ä½å­éŸ³ (Low)": ['à¸„', 'à¸†', 'à¸‡', 'à¸Š', 'à¸‹', 'à¸Œ', 'à¸', 'à¸‘', 'à¸’', 'à¸“', 'à¸—', 'à¸˜', 'à¸™', 'à¸', 'à¸Ÿ', 'à¸ ', 'à¸¡', 'à¸¢', 'à¸£', 'à¸¥', 'à¸§', 'à¸¬', 'à¸®']
        };

        const optionLetters = ['A', 'B', 'C', 'D'];
        let currentQuiz = null;
        let isAnswered = false;
        
        // ç§»é™¤ questionCounterï¼Œå› ç‚ºä¸å†é¡¯ç¤ºé¡Œè™Ÿ
        // let questionCounter = 1;

        /**
         * éš¨æ©Ÿé¸æ“‡æ•¸çµ„ä¸­çš„ä¸€å€‹å…ƒç´ 
         * @param {Array} arr 
         * @returns {*}
         */
        function randomChoice(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        /**
         * å¾æ•¸çµ„ä¸­éš¨æ©Ÿé¸æ“‡ n å€‹ä¸é‡è¤‡çš„å…ƒç´ 
         * @param {Array} arr 
         * @param {number} n 
         * @returns {Array}
         */
        function randomSample(arr, n) {
            if (n > arr.length) return [...arr]; // é¿å…éŒ¯èª¤
            let result = new Array(n),
                len = arr.length,
                taken = new Array(len);
            while (n--) {
                const x = Math.floor(Math.random() * len);
                result[n] = arr[x in taken ? taken[x] : x];
                taken[x] = --len in taken ? taken[len] : len;
            }
            return result;
        }

        /**
         * é‡æ–°å¯¦ç¾ Python çš„é¡Œç›®ç”Ÿæˆé‚è¼¯
         * @returns {Object}
         */
        function generateThaiConsonantQuiz() {
            const allClasses = Object.keys(CONSONANTS);

            // 1. é¸æ“‡èª˜ç­”é …é¡åˆ¥å’Œæ­£ç¢ºç­”æ¡ˆé¡åˆ¥
            let distractorClass = randomChoice(allClasses);
            let answerClassOptions = allClasses.filter(c => c !== distractorClass);
            let answerClass = randomChoice(answerClassOptions);
            
            // è™•ç†æ¥µå°‘æ•¸æƒ…æ³ä¸‹çš„é‡è©¦
            if (!answerClass) return generateThaiConsonantQuiz();

            // 2. æŠ½å– 3 å€‹èª˜ç­”é …
            const distractorOptions = randomSample(CONSONANTS[distractorClass], 3);

            // 3. æŠ½å– 1 å€‹æ­£ç¢ºç­”æ¡ˆ
            const correctOption = randomChoice(CONSONANTS[answerClass]);

            // 4. çµ„åˆæ‰€æœ‰é¸é …ä¸¦æ‰“äº‚
            const allOptions = distractorOptions.concat([correctOption]);
            allOptions.sort(() => Math.random() - 0.5); // ç°¡å–®æ‰“äº‚

            // 5. æ ¼å¼åŒ–è¼¸å‡º
            // ç§»é™¤é¡Œè™Ÿ
            const questionText = `è«‹å•ä¸‹åˆ—å“ªå€‹é¸é …çš„æ³°æ–‡å­éŸ³é¡åˆ¥å’Œå…¶ä»–é¸é …ä¸åŒï¼Ÿ`;

            const correctCategoryName = answerClass.split(' ')[0];
            const distractorCategoryName = distractorClass.split(' ')[0];
            
            let correctOptionData = null;

            const quizOptions = allOptions.map((consonant, i) => {
                const isCorrect = (consonant === correctOption);
                
                let rationale;
                if (isCorrect) {
                    rationale = `${consonant} å±¬æ–¼${correctCategoryName}ï¼Œè€Œå…¶ä»–ä¸‰å€‹é¸é …çš†å±¬æ–¼${distractorCategoryName}ã€‚`;
                } else {
                    rationale = `${consonant} å±¬æ–¼${distractorCategoryName}ï¼Œå’Œæ­£ç¢ºç­”æ¡ˆï¼ˆ${correctCategoryName}ï¼‰ä¸åŒã€‚`;
                }

                const optionData = {
                    consonant: consonant,
                    letter: optionLetters[i],
                    is_correct: isCorrect,
                    rationale: rationale,
                };
                
                if (isCorrect) {
                    correctOptionData = optionData;
                }
                
                return optionData;
            });

            return {
                question: questionText,
                options: quizOptions,
                correct_answer: correctOptionData,
                explanation: correctOptionData.rationale,
            };
        }

        /**
         * æª¢æŸ¥ä½¿ç”¨è€…é¸æ“‡çš„ç­”æ¡ˆ
         * @param {HTMLElement} button 
         * @param {Object} optionData 
         */
        function checkAnswer(button, optionData) {
            if (isAnswered) return;
            isAnswered = true;

            const messageBox = document.getElementById('message-box');
            const explanationBox = document.getElementById('explanation-box');
            const explanationText = document.getElementById('explanation-text');
            const optionsContainer = document.getElementById('options-container');

            // é¡¯ç¤ºè©³è§£
            explanationText.textContent = currentQuiz.explanation;
            explanationBox.classList.remove('hidden');

            if (optionData.is_correct) {
                messageBox.innerHTML = '<span class="text-green-600">âœ… æ­£ç¢ºï¼</span>';
                button.classList.add('correct-answer');
            } else {
                messageBox.innerHTML = '<span class="text-red-600">âŒ éŒ¯èª¤ï¼Œè«‹çœ‹è©³è§£ã€‚</span>';
                button.classList.add('incorrect-answer');
                
                // æ‰¾å‡ºæ­£ç¢ºç­”æ¡ˆä¸¦æ¨™è¨»
                const correctButton = Array.from(optionsContainer.children).find(btn => 
                    btn.dataset.isCorrect === 'true'
                );
                if (correctButton) {
                    correctButton.classList.add('correct-answer');
                }
            }
            
            // ç¦ç”¨æ‰€æœ‰æŒ‰éˆ•
            Array.from(optionsContainer.children).forEach(btn => btn.disabled = true);
        }
        
        /**
         * è¼‰å…¥ä¸¦æ¸²æŸ“ä¸‹ä¸€é“é¡Œç›®
         */
        function loadNextQuestion() {
            // ç§»é™¤ questionCounter çš„åƒæ•¸å‚³é
            currentQuiz = generateThaiConsonantQuiz();
            isAnswered = false;

            const questionTextEl = document.getElementById('question-text');
            const optionsContainerEl = document.getElementById('options-container');
            const messageBoxEl = document.getElementById('message-box');
            const explanationBoxEl = document.getElementById('explanation-box');

            // 1. é‡ç½®ç‹€æ…‹å’Œè¨Šæ¯
            messageBoxEl.textContent = 'è«‹é¸æ“‡ç­”æ¡ˆ'; // ç°¡åŒ–/æ›¿æ›äº†åŸæœ‰çš„æç¤º
            explanationBoxEl.classList.add('hidden');
            optionsContainerEl.innerHTML = '';

            // 2. æ¸²æŸ“å•é¡Œ
            questionTextEl.textContent = currentQuiz.question;
            
            // 3. æ¸²æŸ“ç­”æ¡ˆæŒ‰éˆ• (ç›´æ¥é¡¯ç¤ºå­éŸ³)
            currentQuiz.options.forEach(opt => {
                const button = document.createElement('button');
                
                // ç›´æ¥å°‡å­éŸ³ä½œç‚ºæŒ‰éˆ•å…§å®¹ï¼Œä¸¦æ‡‰ç”¨æ³°æ–‡å­—é«”æ¨£å¼
                button.textContent = opt.consonant; 
                
                button.className = 'option-button font-thai text-5xl py-3 px-4 bg-gray-50 text-gray-800 border-2 border-gray-300 font-bold rounded-lg shadow-sm hover:bg-primary hover:text-white hover:border-primary focus:outline-none focus:ring-4 focus:ring-primary focus:ring-opacity-50 transition duration-150 ease-in-out';
                button.dataset.isCorrect = opt.is_correct; // å„²å­˜æ­£ç¢ºæ€§æ¨™ç±¤
                button.onclick = function() {
                    checkAnswer(this, opt);
                };
                optionsContainerEl.appendChild(button);
            });
        }

        // é é¢è¼‰å…¥å®Œæˆå¾Œè‡ªå‹•è¼‰å…¥ç¬¬ä¸€é“é¡Œç›®
        window.onload = function() {
            loadNextQuestion();
        };
    </script>
</body>
</html>